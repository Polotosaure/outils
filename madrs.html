<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MADRS - Échelle de Dépression</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @media print {
            body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .no-print { display: none !important; }
            .print-break { page-break-before: always; }
            .break-inside-avoid { break-inside: avoid; }
            input, textarea { border: none !important; background: transparent !important; resize: none; }
            input::placeholder, textarea::placeholder { color: transparent; }
            .shadow-xl { shadow: none !important; }
        }
        
        .option-card {
            transition: all 0.2s;
            cursor: pointer;
        }
        .option-card:hover { background-color: #f3f4f6; }
        
        /* Sélection */
        .selected-0 { background-color: #ecfdf5; border-color: #10b981; color: #065f46; } /* Vert */
        .selected-1, .selected-2 { background-color: #eff6ff; border-color: #3b82f6; color: #1e40af; } /* Bleu */
        .selected-3, .selected-4 { background-color: #fff7ed; border-color: #f97316; color: #9a3412; } /* Orange */
        .selected-5, .selected-6 { background-color: #fef2f2; border-color: #ef4444; color: #991b1b; } /* Rouge */

        .score-btn {
            width: 40px; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 9999px;
            font-weight: bold;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        .score-btn.active { transform: scale(1.1); border-color: currentColor; }
    </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen text-gray-800">

    <!-- Barre d'outils (Masquée à l'impression) -->
    <div class="no-print sticky top-0 z-50 bg-white border-b shadow-md p-4 mb-6">
        <div class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-2 rounded-lg text-white">
                    <i data-lucide="activity"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-800">MADRS Numérique</h1>
            </div>
            
            <div class="flex gap-3">
                <button onclick="resetForm()" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">
                    <i data-lucide="rotate-ccw" width="16"></i> Réinitialiser
                </button>
                <button onclick="window.print()" class="flex items-center gap-2 px-6 py-2 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-sm transition-colors">
                    <i data-lucide="printer" width="16"></i> Imprimer / PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Document Principal -->
    <div class="max-w-4xl mx-auto p-8 bg-white shadow-xl mb-10 print:shadow-none print:p-0 print:mb-0">
        
        <!-- En-tête -->
        <div class="border-b-4 border-gray-800 pb-6 mb-8">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-1">Échelle MADRS</h1>
                    <p class="text-gray-500 text-sm uppercase tracking-wide">Montgomery-Åsberg Depression Rating Scale</p>
                </div>
                <div class="text-right hidden print:block">
                    <div class="text-xs text-gray-400" id="print-date"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 p-6 rounded-lg border border-gray-200 print:bg-white print:border-gray-300">
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1">
                            <i data-lucide="user" width="12"></i> Nom du Patient
                        </label>
                        <input type="text" placeholder="Nom Prénom" class="w-full bg-white border border-gray-300 rounded p-2 outline-none focus:ring-2 focus:ring-indigo-500 font-medium text-lg print:p-0">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1">
                            <i data-lucide="calendar" width="12"></i> Date de Naissance
                        </label>
                        <input type="date" class="w-full bg-white border border-gray-300 rounded p-2 outline-none focus:ring-2 focus:ring-indigo-500 print:p-0">
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Praticien / Examinateur</label>
                        <input type="text" placeholder="Dr..." class="w-full bg-white border border-gray-300 rounded p-2 outline-none focus:ring-2 focus:ring-indigo-500 print:p-0">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Date de l'entretien</label>
                        <input type="date" id="date-entretien" class="w-full bg-white border border-gray-300 rounded p-2 outline-none focus:ring-2 focus:ring-indigo-500 print:p-0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Score Flottant (Visible only on screen) -->
        <div class="no-print fixed bottom-8 right-8 z-40">
            <div class="bg-gray-900 text-white rounded-full px-6 py-3 shadow-2xl flex items-center gap-3">
                <span class="text-sm font-medium uppercase tracking-wider text-gray-400">Total</span>
                <span id="floating-score" class="text-2xl font-bold">0</span>
            </div>
        </div>

        <!-- Questionnaire -->
        <div id="question-container" class="space-y-8">
            <!-- Les questions seront générées ici par JS -->
        </div>

        <!-- Résumé / Conclusion -->
        <div class="mt-12 border-t-2 border-gray-300 pt-6 break-inside-avoid print-break">
            <h3 class="text-xl font-bold text-gray-900 mb-6">Résultats & Interprétation</h3>
            
            <div class="flex flex-col md:flex-row gap-6 mb-8">
                <!-- Score Box -->
                <div class="w-full md:w-1/3 bg-gray-100 rounded-xl p-6 flex flex-col items-center justify-center border border-gray-200 print:bg-white print:border-2 print:border-gray-800">
                    <span class="text-gray-500 font-bold uppercase text-xs mb-2">Score Total MADRS</span>
                    <span id="final-score" class="text-5xl font-bold text-indigo-700 print:text-black">0</span>
                    <span class="text-gray-400 text-xs mt-2">sur 60</span>
                </div>

                <!-- Interpretation Box -->
                <div class="w-full md:w-2/3 bg-white rounded-xl border border-gray-200 p-6 print:border-0 print:p-0">
                    <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">Niveau de dépression suggéré</h4>
                    
                    <div class="space-y-3">
                        <div id="level-0" class="flex items-center gap-3 p-2 rounded opacity-30 transition-all">
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            <div class="font-bold w-24">Normal</div>
                            <div class="text-sm text-gray-500">0 à 6</div>
                        </div>
                        <div id="level-1" class="flex items-center gap-3 p-2 rounded opacity-30 transition-all">
                            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                            <div class="font-bold w-24">Légère</div>
                            <div class="text-sm text-gray-500">7 à 19</div>
                        </div>
                        <div id="level-2" class="flex items-center gap-3 p-2 rounded opacity-30 transition-all">
                            <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                            <div class="font-bold w-24">Modérée</div>
                            <div class="text-sm text-gray-500">20 à 34</div>
                        </div>
                        <div id="level-3" class="flex items-center gap-3 p-2 rounded opacity-30 transition-all">
                            <div class="w-3 h-3 rounded-full bg-red-600"></div>
                            <div class="font-bold w-24">Sévère</div>
                            <div class="text-sm text-gray-500">> 34</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded p-4 mb-6 print:bg-white print:border-gray-300 text-sm text-yellow-800 print:text-gray-600">
                <i data-lucide="alert-triangle" class="inline w-4 h-4 mr-1 mb-1"></i>
                <strong>Note :</strong> Le score Item 10 (Idées de suicide) doit toujours faire l'objet d'une attention clinique immédiate, indépendamment du score total.
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">Commentaires Cliniques</label>
                <textarea class="w-full p-4 border border-gray-300 rounded-lg min-h-[150px] print:border print:border-gray-400" placeholder="Observations, contexte, risques suicidaires..."></textarea>
            </div>

            <div class="mt-12 pt-8 border-t border-gray-200 flex justify-end gap-16 text-sm print:mt-16">
                <div class="text-center">
                    <div class="mb-12 font-bold">Signature du Praticien</div>
                    <div class="w-48 border-b border-gray-400"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logique JavaScript -->
    <script>
        // Données MADRS
        const madrsData = [
            {
                id: 1,
                title: "Tristesse apparente",
                desc: "Représente le découragement, la dépression et le désespoir (ce qui est reflété par la parole, la mimique et la posture). Evaluer selon l'ampleur de l'incapacité à s'égayer.",
                options: {
                    0: "Pas de tristesse.",
                    2: "A l'air découragé mais peut s'égayer sans difficulté.",
                    4: "A l'air triste et malheureux la plupart du temps.",
                    6: "A l'air malheureux tout le temps. Extrêmement découragé."
                }
            },
            {
                id: 2,
                title: "Tristesse exprimée",
                desc: "Représente l'expression verbale d'humeur dépressive, quel qu'en soit le motif (ex: événements de la vie, maladie). Notez selon l'intensité, la durée et la mesure dans laquelle l'humeur est influencée par les événements.",
                options: {
                    0: "Tristesse occasionnelle en rapport avec les circonstances.",
                    2: "Triste ou humeur basse, mais s'égaie sans difficulté.",
                    4: "Sentiments envahissants de tristesse ou de morosité. L'humeur est encore influencée par des circonstances extérieures.",
                    6: "Tristesse, désespoir ou découragement continus ou invariables."
                }
            },
            {
                id: 3,
                title: "Tension intérieure",
                desc: "Représente des sentiments de malaise mal définis, d'irritabilité, d'agitation interne, de tension nerveuse allant jusqu'à l'attaque de panique.",
                options: {
                    0: "Placide. Rien qu'une tension passagère.",
                    2: "Sentiments occasionnels de nervosité et d'inconfort indéfinis.",
                    4: "Sentiments continuels de tension interne ou de panique intermittente que le patient ne peut maîtriser qu'avec difficulté.",
                    6: "Terreur ou angoisse tenace. Panique envahissante."
                }
            },
            {
                id: 4,
                title: "Sommeil réduit",
                desc: "Représente la réduction de la durée ou de la profondeur du sommeil par rapport au sommeil normal du sujet lorsqu'il va bien.",
                options: {
                    0: "Dort comme d'habitude.",
                    2: "Légères difficultés d'endormissement ou sommeil légèrement réduit, léger ou agité.",
                    4: "Sommeil réduit ou fractionné d'au moins deux heures.",
                    6: "Moins de deux ou trois heures de sommeil."
                }
            },
            {
                id: 5,
                title: "Appétit réduit",
                desc: "Représente la sensation de perte d'appétit par rapport à l'appétit habituel.",
                options: {
                    0: "Appétit normal ou augmenté.",
                    2: "Appétit légèrement réduit.",
                    4: "Pas d'appétit. La nourriture est fade.",
                    6: "Ne mange que si on le force. A besoin d'être persuadé de manger."
                }
            },
            {
                id: 6,
                title: "Difficultés de concentration",
                desc: "Représente les difficultés à rassembler ses pensées, allant jusqu'à l'incapacité de se concentrer.",
                options: {
                    0: "Pas de difficultés de concentration.",
                    2: "Difficultés occasionnelles à rassembler sa pensée.",
                    4: "Difficultés à se concentrer et à soutenir sa pensée, ce qui gêne la lecture ou la conversation.",
                    6: "Incapacité à lire ou à converser si ce n'est avec beaucoup d'efforts."
                }
            },
            {
                id: 7,
                title: "Lassitude",
                desc: "Représente une difficulté à se mettre à la tâche ou une lenteur à l'exécuter et à la terminer.",
                options: {
                    0: "Peu de difficultés à se mettre à l'ouvrage. Pas de lenteur.",
                    2: "Difficultés à commencer des activités.",
                    4: "Difficultés à commencer de simples activités de routine qui demandent un effort.",
                    6: "Lassitude totale. Incapable de faire quoi que ce soit sans aide."
                }
            },
            {
                id: 8,
                title: "Incapacité à ressentir",
                desc: "Représente l'expérience subjective d'une réduction de l'intérêt pour le monde environnant ou pour les activités qui donnent normalement du plaisir.",
                options: {
                    0: "Intérêt normal pour l'entourage et pour les autres.",
                    2: "Capacité réduite à prendre du plaisir à ses intérêts habituels.",
                    4: "Perte d'intérêt pour l'entourage. Perte de sentiments pour les amis et les connaissances.",
                    6: "L'expérience d'être émotionnellement paralysé, incapacité à ressentir de la colère, du chagrin ou du plaisir (apathie totale)."
                }
            },
            {
                id: 9,
                title: "Pensées pessimistes",
                desc: "Représente les pensées de culpabilité, d'infériorité, d'auto-accusation, de péché, de remords et de ruine.",
                options: {
                    0: "Pas de pensées pessimistes.",
                    2: "Idées fluctuantes d'échec, d'auto-reproche ou d'auto-dépréciation.",
                    4: "Auto-accusations persistantes ou idées de culpabilité ou de péché définies mais encore rationnelles.",
                    6: "Délire de ruine, de remords ou de péché non réparable. Auto-accusations absurdes et inébranlables."
                }
            },
            {
                id: 10,
                title: "Idées de suicide",
                desc: "Représente le sentiment que la vie ne vaut pas la peine d'être vécue, qu'une mort naturelle serait la bienvenue, les pensées suicidaires et les préparatifs au suicide.",
                options: {
                    0: "Jouit de la vie ou la prend comme elle vient.",
                    2: "Lasse de vivre. Idées de suicide passagères.",
                    4: "Aurait probablement mieux valu être mort. Les idées de suicide sont courantes, et le suicide est considéré comme une solution possible.",
                    6: "Plans explicites de suicide au moment de l'occasion. Préparatifs actifs de suicide."
                }
            }
        ];

        // État (stocke les scores: { 1: 4, 2: 0, ... })
        let scores = {};

        function renderQuestions() {
            const container = document.getElementById('question-container');
            
            container.innerHTML = madrsData.map(q => `
                <div class="break-inside-avoid border border-gray-200 rounded-lg bg-white p-6 shadow-sm print:border-black print:shadow-none">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex justify-between">
                            <span>${q.id}. ${q.title}</span>
                            <span class="text-indigo-600 font-bold print:text-black" id="display-score-${q.id}">- / 6</span>
                        </h3>
                        <p class="text-sm text-gray-500 italic mt-1 print:text-gray-700">${q.desc}</p>
                    </div>

                    <div class="space-y-2">
                        <!-- Points d'ancrage textuels -->
                        <div class="grid grid-cols-1 gap-2 text-sm">
                            ${[0, 2, 4, 6].map(val => `
                                <div onclick="selectScore(${q.id}, ${val})" 
                                     id="card-${q.id}-${val}"
                                     class="option-card p-3 rounded border border-gray-100 flex gap-3 items-start">
                                    <div class="font-bold text-gray-400 min-w-[20px]">${val}</div>
                                    <div class="text-gray-700">${q.options[val]}</div>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Sélecteur fin (0-6) -->
                        <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center no-print">
                            <span class="text-xs font-bold text-gray-400 uppercase mr-2">Sélection précise :</span>
                            <div class="flex gap-1 md:gap-2">
                                ${[0, 1, 2, 3, 4, 5, 6].map(val => `
                                    <button onclick="selectScore(${q.id}, ${val})" 
                                            id="btn-${q.id}-${val}"
                                            class="score-btn hover:bg-indigo-50 hover:text-indigo-600 text-gray-400">
                                        ${val}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectScore(qId, val) {
            scores[qId] = val;
            updateUI(qId, val);
            calculateTotal();
        }

        function updateUI(qId, val) {
            // Update Text in Header
            document.getElementById(`display-score-${qId}`).innerText = val + " / 6";

            // Reset Cards Visuals for this question
            [0, 2, 4, 6].forEach(v => {
                const card = document.getElementById(`card-${qId}-${v}`);
                if(card) {
                    card.className = "option-card p-3 rounded border border-gray-100 flex gap-3 items-start"; // reset
                }
            });

            // Reset Buttons Visuals
            for(let i=0; i<=6; i++) {
                const btn = document.getElementById(`btn-${qId}-${i}`);
                if(btn) btn.className = "score-btn hover:bg-indigo-50 hover:text-indigo-600 text-gray-400";
            }

            // Highlight Selected Button
            const activeBtn = document.getElementById(`btn-${qId}-${val}`);
            if(activeBtn) {
                activeBtn.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600', 'active');
                activeBtn.classList.remove('text-gray-400', 'hover:bg-indigo-50');
            }

            // Highlight Closest Card (Standard behavior: if I click 1, highlight 0 or 2? Usually imply intermediate. 
            // Let's highlight the specific card if it matches exactly 0, 2, 4, 6)
            if ([0, 2, 4, 6].includes(val)) {
                const activeCard = document.getElementById(`card-${qId}-${val}`);
                if(activeCard) {
                    activeCard.classList.add(`selected-${val}`);
                    activeCard.classList.remove('border-gray-100');
                }
            } else {
                // Optional: Highlight the two surrounding cards lightly? 
                // For simplicity, we only highlight if exact match, or maybe none.
                // Let's keep it clean.
            }
        }

        function calculateTotal() {
            let total = 0;
            Object.values(scores).forEach(v => total += v);
            
            // Affichage
            document.getElementById('final-score').innerText = total;
            document.getElementById('floating-score').innerText = total;

            // Interpretation
            highlightLevel(total);
        }

        function highlightLevel(score) {
            // Reset opacity
            ['level-0', 'level-1', 'level-2', 'level-3'].forEach(id => {
                const el = document.getElementById(id);
                el.classList.add('opacity-30');
                el.classList.remove('bg-gray-100', 'shadow-inner');
            });

            let activeId = 'level-0';
            if (score >= 7 && score <= 19) activeId = 'level-1';
            if (score >= 20 && score <= 34) activeId = 'level-2';
            if (score > 34) activeId = 'level-3';

            const activeEl = document.getElementById(activeId);
            activeEl.classList.remove('opacity-30');
            activeEl.classList.add('bg-gray-50', 'shadow-sm', 'border', 'border-gray-200');
        }

        function resetForm() {
            if(confirm("Effacer tout le formulaire ?")) {
                scores = {};
                document.querySelectorAll('input, textarea').forEach(i => i.value = '');
                document.getElementById('date-entretien').valueAsDate = new Date();
                renderQuestions(); // Re-render to clear classes
                calculateTotal();
            }
        }

        window.onload = function() {
            document.getElementById('date-entretien').valueAsDate = new Date();
            document.getElementById('print-date').textContent = "Généré le " + new Date().toLocaleDateString('fr-FR');
            renderQuestions();
            lucide.createIcons();
        };
    </script>
</body>
</html>
